# IP-01: –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ LearnFlow AI

## –°–º—ã—Å–ª –∏ —Ü–µ–ª—å –∑–∞–¥–∞—á–∏

–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –¥–≤–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–µ—Ç–æ–¥–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ (`process_step()` –∏ `process_step_with_images()`) –≤ –µ–¥–∏–Ω—ã–π —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–π –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Ä–∞–±–æ—Ç—ã —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –∏ —Ç–µ–∫—Å—Ç–æ–≤—ã–º–∏ –∫–æ–Ω—Å–ø–µ–∫—Ç–∞–º–∏. –≠—Ç–æ —É–ø—Ä–æ—Å—Ç–∏—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É, —É–±–µ—Ä–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –∏ —É–ª—É—á—à–∏—Ç UX –∑–∞ —Å—á–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∑–∞–º–µ—Ç–æ–∫ –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç workflow.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏:
- **GraphManager** (`learnflow/core/graph_manager.py`) - —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –º–µ—Ç–æ–¥–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **RecognitionNode** (`learnflow/nodes/recognition.py`) - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤
- **API endpoints** (`learnflow/api/main.py`) - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –∑–∞–ø—Ä–æ—Å–æ–≤
- **Telegram Bot** (`bot/main.py`, `bot/services/api_client.py`) - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–æ–≤–æ–≥–æ API

–†–∞–∑–º–µ—â–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –æ—Å—Ç–∞–µ—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–º –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –ø—Ä–æ–µ–∫—Ç–∞.

## –ü–æ–ª–Ω—ã–π flow —Ä–∞–±–æ—Ç—ã —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –°—Ç–∞—Ä—Ç —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–æ—Ç–æ + —Ç–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞ –≤ Telegram
2. Bot –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç –º–µ–¥–∏–∞ –≤ `pending_media` 
3. Bot –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ `/upload-images/{thread_id}`
4. Bot –≤—ã–∑—ã–≤–∞–µ—Ç —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π `process_step()` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `image_paths`
5. GraphManager —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å `input_content` –∏ `image_paths`
6. RecognitionNode –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏—Ö
7. –ü—Ä–∏ —É—Å–ø–µ—Ö–µ –∏–¥–µ—Ç —Å–∏–Ω—Ç–µ–∑ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤, –ø—Ä–∏ –æ—à–∏–±–∫–µ - –ø—Ä–æ–ø—É—Å–∫ –∫ –≤–æ–ø—Ä–æ—Å–∞–º

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—á–∏–Ω–∞–µ—Ç –±–µ–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
2. RecognitionNode –¥–µ–ª–∞–µ—Ç interrupt —Å –∑–∞–ø—Ä–æ—Å–æ–º –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç —Ç–µ–∫—Å—Ç –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤ (>50 —Å–∏–º–≤–æ–ª–æ–≤)
4. RecognitionNode –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–ª–∏–Ω—É –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ–∫—Å—Ç –∫–∞–∫ `recognized_notes`
5. –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–∏–Ω—Ç–µ–∑—É –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ —Å —Ç–µ–∫—Å—Ç–æ–≤—ã–º–∏ –∫–æ–Ω—Å–ø–µ–∫—Ç–∞–º–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ
1. –ü–æ—Å–ª–µ interrupt RecognitionNode –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –∫–æ–Ω—Å–ø–µ–∫—Ç—ã
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
3. Bot –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –≤—ã–∑—ã–≤–∞–µ—Ç `process_step()` —Å `image_paths`
4. GraphManager —Å–æ–∑–¥–∞–µ—Ç `Command(resume=..., update={"image_paths": ...})`
5. RecognitionNode –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–æ–≤—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ü—Ä–æ–ø—É—Å–∫ –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤
1. RecognitionNode –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –∫–æ–Ω—Å–ø–µ–∫—Ç—ã —á–µ—Ä–µ–∑ interrupt
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç "–ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å"
3. RecognitionNode –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ `generating_questions` –±–µ–∑ —Å–∏–Ω—Ç–µ–∑–∞
4. `synthesized_material` –∫–æ–ø–∏—Ä—É–µ—Ç `generated_material`

## API –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

### GraphManager.process_step()
- **–ù–∞–∑–≤–∞–Ω–∏–µ**: `process_step`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ workflow
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: 
  - `thread_id` - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ—Ç–æ–∫–∞
  - `query` - —Ç–µ–∫—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∏–ª–∏ –∫–æ–º–∞–Ω–¥–∞
  - `image_paths` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - —Å–ø–∏—Å–æ–∫ –ø—É—Ç–µ–π –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: —Å–ª–æ–≤–∞—Ä—å —Å `thread_id` –∏ `result` (—Å–æ–æ–±—â–µ–Ω–∏—è)
- **–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏**: –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ GraphManager, –æ—à–∏–±–∫–∏ –ë–î

### RecognitionNode.__call__()
- **–ù–∞–∑–≤–∞–Ω–∏–µ**: `__call__`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤ (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, —Ç–µ–∫—Å—Ç, –ø—Ä–æ–ø—É—Å–∫)
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
  - `state` - —Å–æ—Å—Ç–æ—è–Ω–∏–µ workflow —Å –≤–æ–∑–º–æ–∂–Ω—ã–º–∏ `image_paths`
  - `config` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è LangGraph
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: `Command` —Å –ø–µ—Ä–µ—Ö–æ–¥–æ–º –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è
- **–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏**: –æ—à–∏–±–∫–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è gracefully)

### RecognitionNode –≤–∞–ª–∏–¥–∞—Ü–∏—è
- **MIN_TEXT_LENGTH = 50** - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –≤–∞–ª–∏–¥–Ω—ã—Ö –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤
- –¢–µ–∫—Å—Ç –∫–æ—Ä–æ—á–µ —Ç—Ä–∞–∫—Ç—É–µ—Ç—Å—è –∫–∞–∫ –ø—Ä–æ–ø—É—Å–∫
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤: "–ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å", "skip", "–Ω–µ—Ç"

## –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```
Telegram Bot -> API /process -> GraphManager.process_step()
                                       |
                                       v
                              [–ù–æ–≤—ã–π workflow?]
                                 /          \
                               –î–∞           –ù–µ—Ç  
                               /              \
                        GeneralState         Command(resume)
                     (input_content,       (+update –µ—Å–ª–∏
                      image_paths)         –µ—Å—Ç—å image_paths)
                            |                    |
                            v                    v
                      RecognitionNode <----------
                            |
                     [–ï—Å—Ç—å image_paths?]
                        /           \
                      –î–∞            –ù–µ—Ç
                      /               \
              –û–±—Ä–∞–±–æ—Ç–∫–∞          interrupt
              –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π        (–∑–∞–ø—Ä–æ—Å)
                   |                  |
                   v                  v
            synthesis_material   –û—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                                      |
                              [–¢–∏–ø –æ—Ç–≤–µ—Ç–∞?]
                           /      |         \
                    –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è  –¢–µ–∫—Å—Ç   "–ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å"
                         |        |           |
                    –†–µ—Å—Ç–∞—Ä—Ç   –í–∞–ª–∏–¥–∞—Ü–∏—è    –ü—Ä–æ–ø—É—Å–∫
                     —É–∑–ª–∞      –¥–ª–∏–Ω—ã      —Å–∏–Ω—Ç–µ–∑–∞
```

## –ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –®–∞–≥ 1: –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è GraphManager (–†–ï–ê–õ–ò–ó–ê–¶–ò–Ø)

```python
class GraphManager:
    async def process_step(
        self, 
        thread_id: str, 
        query: str, 
        image_paths: List[str] = None
    ) -> Dict[str, Any]:
        """
        –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —à–∞–≥–æ–≤ workflow.
        
        Args:
            thread_id: –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ—Ç–æ–∫–∞
            query: –¢–µ–∫—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∏–ª–∏ –∫–æ–º–∞–Ω–¥–∞
            image_paths: –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø—É—Ç–µ–π –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º
            
        Returns:
            –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å thread_id –∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
        """
        state = await self._get_state(thread_id)
        
        if not state.values:
            # –ù–æ–≤—ã–π workflow - —Å–æ–∑–¥–∞–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            input_state = GeneralState(
                input_content=query,
                image_paths=image_paths or []
            )
            session_id = self.create_new_session(thread_id)
        else:
            # –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ workflow
            if image_paths:
                # –î–æ–±–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ Command.update
                input_state = Command(
                    resume=query,
                    update={"image_paths": image_paths}
                )
            else:
                # –û–±—ã—á–Ω–æ–µ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –±–µ–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
                input_state = Command(resume=query)
            
            session_id = self.get_session_id(thread_id) or self.create_new_session(thread_id)
        
        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –∑–∞–ø—É—Å–∫ workflow
        cfg = {
            "configurable": {"thread_id": thread_id},
            "callbacks": [self.langfuse_handler],
            "metadata": {
                "langfuse_session_id": session_id,
                "langfuse_user_id": thread_id
            },
        }
        
        # ... –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
```

### –®–∞–≥ 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ RecognitionNode (–†–ï–ê–õ–ò–ó–ê–¶–ò–Ø)

```python
class RecognitionNode(BaseWorkflowNode):
    """
    –£–∑–µ–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:
    - –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Ä—É–∫–æ–ø–∏—Å–Ω—ã—Ö –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤
    - –ü—Ä—è–º–æ–≥–æ –≤–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤ (–ø–µ—á–∞—Ç–Ω—ã–π –≤–∏–¥)
    - –í–∞–ª–∏–¥–∞—Ü–∏–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –¥–ª–∏–Ω—ã —Ç–µ–∫—Å—Ç–∞
    - –ü—Ä–æ–ø—É—Å–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ –∂–µ–ª–∞–Ω–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    """
    
    MIN_TEXT_LENGTH = 50  # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –¥–ª—è –≤–∞–ª–∏–¥–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –∫–æ–Ω—Å–ø–µ–∫—Ç–∞
    
    async def __call__(self, state: GeneralState, config) -> Command:
        thread_id = config["configurable"]["thread_id"]
        logger.info(f"RecognitionNode started for thread {thread_id}")
        
        # –ï—Å–ª–∏ –µ—Å—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è - –ø—ã—Ç–∞–µ–º—Å—è —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å
        if state.image_paths:
            logger.info(f"Found {len(state.image_paths)} images, starting recognition")
            
            recognized_text = await self._process_images(state.image_paths)
            
            if recognized_text:
                logger.info(f"Recognition successful, proceeding to synthesis")
                return Command(
                    goto="synthesis_material",
                    update={"recognized_notes": recognized_text}
                )
            else:
                logger.warning(f"Recognition failed, skipping synthesis")
                return Command(
                    goto="generating_questions",
                    update={"synthesized_material": state.generated_material}
                )
        
        # –ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π - –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        logger.info(f"No images found, requesting notes from user")
        
        interrupt_json = {
            "message": "üì∏ –î–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –≤–∞—à–∏ –∫–æ–Ω—Å–ø–µ–∫—Ç—ã.\n\n"
                      "–í–∞—Ä–∏–∞–Ω—Ç—ã –¥–µ–π—Å—Ç–≤–∏–π:\n"
                      "‚Ä¢ –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Ä—É–∫–æ–ø–∏—Å–Ω—ã—Ö –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤\n"
                      "‚Ä¢ –í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç —É–∂–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã—Ö/–ø–µ—á–∞—Ç–Ω—ã—Ö –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤\n"
                      "‚Ä¢ –ù–∞–ø–∏—à–∏—Ç–µ '–ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å' –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –±–µ–∑ –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤"
        }
        
        user_response = interrupt(interrupt_json)
        
        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        if '–ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å' in user_response.lower():
            logger.info("User chose to skip notes")
            return Command(
                goto="generating_questions",
                update={"synthesized_material": state.generated_material}
            )
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–ª–∏–Ω—É —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
        cleaned_text = user_response.strip()
        if len(cleaned_text) < self.MIN_TEXT_LENGTH:
            logger.warning(f"Text too short ({len(cleaned_text)} chars), treating as skip")
            return Command(
                goto="generating_questions",
                update={"synthesized_material": state.generated_material}
            )
        
        # –¢–µ–∫—Å—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π –¥–ª–∏–Ω—ã - –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞–∫ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–µ –∫–æ–Ω—Å–ø–µ–∫—Ç—ã
        logger.info(f"Received text notes ({len(cleaned_text)} chars), proceeding to synthesis")
        return Command(
            goto="synthesis_material",
            update={"recognized_notes": cleaned_text}
        )
```

### –®–∞–≥ 3: –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è API endpoints

–û–±–Ω–æ–≤–∏—Ç—å –º–æ–¥–µ–ª—å `ProcessRequest` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ `image_paths`:
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `image_paths: Optional[List[str]]`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–¥–∏–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç `/process` –¥–ª—è –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- –£–¥–∞–ª–∏—Ç—å –∏–ª–∏ deprecated `/process-with-images`

### –®–∞–≥ 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Telegram Bot

–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å `_process_message()` –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:
- –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `image_paths` –≤ –º–µ—Ç–æ–¥
- –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å `image_paths` –≤ JSON –∑–∞–ø—Ä–æ—Å–µ –∫ API
- –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –∏ –±–µ–∑

### –®–∞–≥ 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞:
1. –°—Ç–∞—Ä—Ç —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤
3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ
4. –ü—Ä–æ–ø—É—Å–∫ –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤
5. –ö–æ—Ä–æ—Ç–∫–∏–π —Ç–µ–∫—Å—Ç (–∞–≤—Ç–æ–ø—Ä–æ–ø—É—Å–∫)
6. –û—à–∏–±–∫–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è

## –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏

### –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤
- –¢–µ–∫—Å—Ç –º–µ–Ω–µ–µ 50 —Å–∏–º–≤–æ–ª–æ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ç—Ä–∞–∫—Ç—É–µ—Ç—Å—è –∫–∞–∫ –ø—Ä–æ–ø—É—Å–∫
- –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ—Ä–æ—Ç–∫–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤ —Ç–∏–ø–∞ "–æ–∫" –∫–∞–∫ –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è - workflow –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
- –ü—Ä–∏ –æ—à–∏–±–∫–µ OCR —É–∑–µ–ª –Ω–µ –ø–∞–¥–∞–µ—Ç, –∞ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Å–∏–Ω—Ç–µ–∑
- `synthesized_material` –∫–æ–ø–∏—Ä—É–µ—Ç `generated_material`
- Workflow –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤

### –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ß–µ—Ä–µ–∑ `Command.update` –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ
- –£–∑–µ–ª –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ —Å–µ–±—è —á–µ—Ä–µ–∑ `goto="recognition_handwritten"`
- –°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö