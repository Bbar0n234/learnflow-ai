## **LearnFlow AI Web UI: Архитектура веб-платформы для управления криптографическими учебными материалами**

### **Цели и требования**
- Заменить GitHub-интеграцию на локальную веб-платформу для хранения, рендеринга и структурирования криптографических учебных материалов, генерируемых LearnFlow AI workflow
- Рендерить Markdown с LaTeX-формулами (синтаксис $…$, $$…$$) в браузере через react-markdown + remark-math + rehype-katex
- Интегрироваться с существующей LangGraph архитектурой (FastAPI service + ExamState + workflow nodes)
- Поддерживать полный жизненный цикл: от экзаменационных вопросов и изображений конспектов до готовых материалов с gap-анализом
- Обеспечить локальное редактирование, структурирование (дерево/папки), комментарии и аннотации к фрагментам текста
- Визуализировать workflow состояния и HITL (Human-in-the-Loop) взаимодействия из LangGraph
- Решение должно быть open-source, легко разворачиваться через Docker Compose и работать "из коробки"
---
### **Архитектурные решения и выводы**
**1. Базовая идея:**
- Заменить текущую GitHub-интеграцию (`learnflow/github.py`) на локальную веб-платформу для хранения и управления учебными материалами
- Интегрироваться с существующим LearnFlow AI workflow, используя ExamState как источник данных
- Обеспечить real-time визуализацию процесса генерации материалов через LangGraph nodes

**2. Интеграция с LearnFlow AI Workflow:**
- **Существующий FastAPI service** (`learnflow/main.py`) продолжает обрабатывать экзаменационные вопросы и изображения конспектов
- **LangGraph workflow** генерирует markdown-файлы с LaTeX и сохраняет их в общую директорию, смонтированную через Docker volume
- **Новый Artifacts Service** (дополнительный FastAPI сервис) заменяет GitHub pusher и управляет файловой системой артефактов
- **React SPA** динамически подключается к Artifacts Service и отображает материалы в реальном времени
- При завершении workflow nodes пользователь сразу видит новые файлы и может их редактировать

**3. Технический стек (с сохранением LearnFlow архитектуры):**
- **Существующий LearnFlow Service (FastAPI):**
    - GraphManager для управления LangGraph workflow
    - ExamState для хранения состояния процесса
    - Image processing и OCR через recognition nodes
    - HITL взаимодействия через Telegram bot
- **Новый Artifacts Service (FastAPI):**
    - Работа с файлами (чтение, запись, переименование, перемещение, удаление)
    - API для структуры файлов/папок артефактов
    - WebSocket подключения для real-time обновлений
    - Интеграция с ExamState для получения метаданных workflow
- **Web UI (React SPA с TypeScript):**
    - Рендеринг Markdown с LaTeX (react-markdown + remark-math + rehype-katex)
    - Отображение иерархии файлов/папок с drag-n-drop структурированием
    - Интерфейс для комментариев и аннотаций к фрагментам текста
    - Визуализация workflow статусов и progress индикаторы
    - Real-time обновления через WebSocket при изменении ExamState
**4. Ключевые технические инсайты:**
- **Взаимодействие через API:**
    - React SPA не может напрямую читать Docker volume — всё взаимодействие только через Artifacts Service API
    - Для любой работы с файлами криптографических материалов (чтение, структурирование) SPA делает запросы к Artifacts Service
    - Real-time обновления через WebSocket при изменениях ExamState в LangGraph workflow
- **Физическая и визуальная структура учебных материалов:**
    - Drag-n-drop файлов в React интерфейсе ведёт к изменению физической структуры артефактов на сервере
    - API автоматически перемещает markdown файлы и обновляет метаданные в ExamState
    - Поддержка иерархической структуры: exam_question → generated_material/recognized_notes/synthesized_material/questions_and_answers
- **Редактирование markdown с LaTeX:**
    - Пользователь может редактировать криптографические материалы прямо в браузере с preview LaTeX формул
    - Изменения сохраняются в исходные markdown файлы через Artifacts Service API
    - Синхронизация изменений с ExamState для отслеживания версий материалов
- **Интеграция с LearnFlow workflow:**
    - Визуализация прогресса через LangGraph nodes (input_processing → generating_content → recognition → synthesis → questions → answers)
    - HITL взаимодействия отображаются в Web UI как дополнение к Telegram bot
    - Автоматическое обновление интерфейса при завершении каждого workflow node
- **Будущие расширения:**
    - Версионность материалов через git-подобную систему
    - Экспорт в PDF с корректным рендерингом LaTeX формул
    - AI-редактирование через интеграцию с LangGraph nodes
    - Collaborative editing для преподавателей
    - Интеграция с LangFuse для analytics и monitoring
---
### **Преимущества такого подхода**
- **Максимальная гибкость:** можно реализовать любые кастомные фичи без ограничения внешним движком.
- **Контроль над архитектурой:** всё под твоим контролем — от UI до физического размещения файлов.
- **Масштабируемость:** легко добавить новые функции (AI-редактирование, аннотации, история изменений).
---
### **Твои ключевые мысли и инсайты**
- Легче реализовать свой минималистичный SPA, чем пытаться подстраивать чужой движок под нужную архитектуру.
- Структурирование материалов и работа с ними через drag-n-drop сильно улучшит UX.
- Нет препятствий для разработки собственного мини-бэкенда для всех нужных операций.
- Важно, чтобы решение было open-source и легко поднималось в один клик через Docker Compose.
- Вся работа с файлами должна идти через API (без прямого доступа из браузера к volume).
---
### **Планы на реализацию (roadmap MVP):**
1. **Docker Compose для трёх сервисов:**
    - AI-генератор (Python)
    - Backend (API для файлов)
    - SPA Frontend
2. **Backend:**
    - Реализовать API:
        - `/files` (список и структура файлов)
        - `/read`, `/write`, `/move`, `/delete` для работы с файлами
3. **SPA:**
    - Отображение дерева файлов
    - Рендеринг Markdown+LaTeX
    - UI для drag-n-drop, создания и редактирования заметок
    - Базовая поддержка комментариев/аннотаций
4. **Будущее:**
    - Версионность, импорт/экспорт, поддержка нескольких пользователей, интеграция с AI для автокомментариев/редактирования
---
## **Вывод:**
Твоя стратегия — выстроить open-source сервис для математических материалов с полноценным рендером и редактированием, максимально простым деплоем и гибкой архитектурой, которую удобно развивать. Весь workflow полностью прозрачен: все изменения через API, фронт видит всё, что генерирует AI, пользователь сам управляет структурой и наполнением.